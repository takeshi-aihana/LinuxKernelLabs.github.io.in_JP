* [目次](/README.md#目次index)
*  [デバッグ](/debugging.rst.md#デバッグ)

---

## 演習の仕方

各章の学習を円滑に進めるために実践的な演習を用意しています。これらは一つまたは複数の課題を解決する方法について詳細で段階的なヒントが含まれています。
特定の問題に焦点をあてるため、ほとんどの課題は既存のドライバの「スケルトン」上で実行することになります。
それぞれのドライバのスケルトンには課題を終了するために入力する必要のあるセクションが明示されています。

ドライバのスケルトンは *tools/labs/templates* ディレクトリの中にあるソースコードから生成します。
まず課題を解決するためのドライバのスケルトンを生成するところから始めます。これは *tools/labs* の中で **skels** コマンドを実行します。
ワークスペースをゴチャゴチャさせないようにするために一つの演習のスケルトンだけをビルドし、新しい演習を始める前にワークスペースをきれいすることを推奨します。
そして **LABS** という変数を使って演習を選択できるようになっています：

```bash

   tools/labs $ make clean
   tools/labs $ LABS=kernel_modules make skels
		
   tools/labs $ ls skels/kernel_modules/
   1-2-test-mod  3-error-mod  4-multi-mod  5-oops-mod  6-cmd-mod  \
   7-list-proc  8-kprobes  9-kdb

```

また、同じ変数を使用して特定のタスクのスケルトンをいくつか生成することも可能です：

```shell

   tools/labs $ LABS="kernel_modules/6-cmd-mod kernel_modules/8-kprobes" make skels
		
   tools/labs$ ls skels/kernel_modules
   6-cmd-mod  8-kprobes
```
タスクごとに実行するステップが複数ありますが、通常は一つずつ増えていくようになっています。
For each task you may have multiple steps to perform, usually incremental.
これらのステップは、ソースコードと課題の中で *TODO* というキーワードが付いています。
もし実行するステップが複数ある場合は、 *TODO1*、*TODO2* などのようにキーワードに番号が付与されます。
番号がない場合、それが単一のステップであることを意味しています。
特定のステップから任意のステップをもう一度始めたい場合は **TODO** 変数を使います。
次は、最初に完了した *TODO* のステップでスケルトンを生成する例です：

```shell

   tools/labs $ TODO=2 LABS="kernel_modules/8-kprobes" skels

```

一度ドライバのスケルトンを生成したら ``make`` コマンドで **build** ターゲットを指定することで、それらのドライバをビルドできます：

```shell

   tools/labs $ make build
   echo "# autogenerated, do not edit " > skels/Kbuild
   for i in ./kernel_modules/8-kprobes; do echo "obj-m += $i/" >> skels/Kbuild; done
   make -C /home/tavi/src/linux M=/home/tavi/src/linux/tools/labs/skels ARCH=x86 modules
   make[1]: Entering directory '/home/tavi/src/linux'
   CC [M]  /home/tavi/src/linux/tools/labs/skels/./kernel_modules/8-kprobes/kprobes.o
   Building modules, stage 2.
   MODPOST 1 modules
   CC      /home/tavi/src/linux/tools/labs/skels/./kernel_modules/8-kprobes/kprobes.mod.o
   LD [M]  /home/tavi/src/linux/tools/labs/skels/./kernel_modules/8-kprobes/kprobes.ko
   make[1]: Leaving directory '/home/tavi/src/linux'
```

ビルドしたドライバを VM 環境へコピーするには、``ssh`` コマンドを使うか、**copy** ターゲットを指定して直接 VM 環境のイメージを更新します：

```shell

   tools/labs $ make copy
   ...
   'skels/kernel_modules/8-kprobes/kprobes.ko' -> '/tmp/tmp.4UMKcISmQM/home/root/skels/kernel_modules/8-kprobes/kprobes.ko'

```
   
##### Attention

もし VM 環境が起動中だったら、**copy** ターゲットの実行は失敗します。
お使いのファイルシステムをおかしくしないようにするために、意図的にこのようにしている点に注意して下さい。


---

* [目次](/README.md#目次index)
* [対称型マルチプロセッシング](/smp.rst.md#対称型マルチプロセッシング)
